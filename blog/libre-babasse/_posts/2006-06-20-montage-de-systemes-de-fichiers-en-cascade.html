---
title: Montage de systèmes de fichiers en cascade
---

<h3>Le symptôme</h3><p><q><code>mount: must be superuser to use mount</code></q> vous est renvoyé par votre système lorsque vous tappez <kbd>mount /cdrom</kbd> alors même que vous avez bien vérifié avoir ajouté l'option <code>user</code> sur la ligne correspondante à <code>/cdrom</code> dans le fichier <code>/etc/fstab</code>...</p><h3>Une solution possible</h3><p>Il est possible que vous ayez un peu joué (cf un peu plus loin) avec les permissions des commandes <code>mount</code> et <code>umount</code>. Si vous avez effectivement joué avec, il faut vous assurer que ces commandes sont bien <em>setuid root</em>. Vous pouvez par exemple utiliser la commande suivante : <kbd>sudo chmod u+s /bin/{,u}mount</kbd>.</p><h3>Mount, Samba, Superutilisateurs, ...</h3><p>Et donc, pour donner une explication sur le pourquoi du comment de mes tripatouillages avec la commande mount : j'avais un problème de partage de répertoire samba, de mobilité et de mots de passe en clair... En effet, un serveur samba partage chez moi un répertoire public et les répertoires utilisateurs de mon réseau. J'y accède depuis un mobile et depuis mon fixe. Je ne veux pas que</p><ul><li>les identifiants utilisateurs apparaissent dans le fichier <code>/etc/fstab</code>.</li><li>les répertoires soient forcément montés automatiquement au démarrage sur le portable.</li></ul><p>Je vous propose la solution suivante, et vous demande toute idée supplémentaire pour améliorer le tout. Sur le fixe (mono-utilisateur), c'est relativement simple, j'ai tout simplement déporté les identifiants dans un fichier de mon répertoire utilisateur et utilisé les lignes de configuration suivantes dans <code>/etc/fstab</code> :</p><p><code>//pastis/homes  /home/clark/server      smbfs   user,noauto,credentials=/home/clark/.smbpass    0       0<br/>//pastis/share  /home/clark/share       smbfs   user,noauto,credentials=/home/clark/.smbpass    0       0</code></p><p>Les répertoires sont ensuite montés au démarrage de ma session grâce au script <code>/home/clark/.config/autostart/smbmount</code> suivant :</p><p><code>#!/bin/bash<br/>mount /home/clark/server<br/>mount /home/clark/share<br/></code></p><p>Une autre alternative est de faire un script en sudo, mais je ne trouve pas ça top non plus... Qu'en dîtes-vous ? Comment faites-vous cela ?</p>
